# 串口通信

## 使用串口通信的步骤  

1. 设置T1的工作方式（多为工作方式2，具体设置见定时器章节）

2. 计算T1的初值，装载TH1，TL1.
   计算方法：![image-20200204163746886](D:%5C%E5%B0%8F%E5%87%AF%E6%96%87%5CDocuments%5C%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1.assets%5Cimage-20200204163746886.png)
   *fosc即单片机的机器周期*
   
3. 启动T1（编程TCON中的TR1位）

4. 确定串行口控制（编程SCON寄存器)

   ```cpp
   	TMOD = 0x20;  	//T1工作模式2  8位自动重装
   	TH1 = 0xfa;		 //即250
   	TL1 = 0xfa; 	//比特率4800
   	TR1 = 1;		//启动T1定时器
   	SM0 = 0;
   	SM1 = 1; 		//串口工作方式1  10位异步
   	REN = 1;		//串口允许接收
   ```

   

5. 读SBUF：读入接收缓存器的数据；写SBUF：数据送入发送寄存器准备发送

6. 接收完成RI会被置1，TI同

## 通信

计算机与外界的通信有两种基本方式：串行通讯与并行通讯（并行 只做了解）


### 并行通讯

​      所谓并行通信是指数据的各位同时在多根数据线上发送或接收。
并行通信控制简单、传输速度快；由于传输线较多，长距离传送时成本高且接收方的各位同时接收存在困难

### 串行通讯

![image-20200201120137196](D:%5C%E5%B0%8F%E5%87%AF%E6%96%87%5CDocuments%5C%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1.assets%5Cimage-20200201120137196.png)

## 异步通信与同步通信

### 异步通信

   异步通信是指通信的发送与接收设备使用各自的时钟控制数据
的发送和接收过程。为使双方的收发协调，要求发送和接收设备
的时钟尽可能一致。
异步通信是以字符（构成的帧）为单位进行传输，字符与字符之间的时间间隔是任意的，但每个字符中的各位是以固定的时间传送的，即字符之间不一定有“位间隔”的整数倍的关系，但同一字符内的各位之间的距离均为“位间隔”的整数倍。如下图所示。

![image-20200201120431148](D:%5C%E5%B0%8F%E5%87%AF%E6%96%87%5CDocuments%5C%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1.assets%5Cimage-20200201120431148.png)

### 同步通信
同步通信时要建立发送方时钟对接收方时钟的直接控制，使双方达到完全同步。此时，传输数据的位之间的距离均为“位间隔”的整数倍，同时传送的字符间不留间隙，即保持位同步关系，也保持字符同步关系。

## 串行控制寄存器SCON

*虽然这个寄存器的地址是98H，不能被8整除，但是仍然可以使用字节寻址与位寻址两种操作方式*

![](D:%5C%E5%B0%8F%E5%87%AF%E6%96%87%5CDocuments%5C%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1.assets%5Cimage-20200202101347011.png)
![image-20200202101414858](D:%5C%E5%B0%8F%E5%87%AF%E6%96%87%5CDocuments%5C%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1.assets%5Cimage-20200202101414858.png)


