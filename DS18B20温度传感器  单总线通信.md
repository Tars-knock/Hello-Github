#DS18B20温度传感器

##基础属性

1. 通信采用1-wire接口（单总线通信）

2. 每个DS18B20都有唯一的64位序列码储存在板载ROM中

3. 无需外部元件

4. 可从数据线供电，电源范围为3v~5.5v（数据线供电接法如图）
   ![image-20200215121935930](DS18B20%E6%B8%A9%E5%BA%A6%E4%BC%A0%E6%84%9F%E5%99%A8%20%20%E5%8D%95%E6%80%BB%E7%BA%BF%E9%80%9A%E4%BF%A1.assets/image-20200215121935930.png)

5. 可测量的温度范围在-55℃~+125℃

6. 在-10~+85℃范围内精确范围在±0.5℃

7. 温度计分辨率可设置为9~12位，12位时分辨率对应为0.0625℃

## 暂存器

![image-20200215162645697](DS18B20%E6%B8%A9%E5%BA%A6%E4%BC%A0%E6%84%9F%E5%99%A8%20%20%E5%8D%95%E6%80%BB%E7%BA%BF%E9%80%9A%E4%BF%A1.assets/image-20200215162645697.png)

![image-20200215162942636](DS18B20%E6%B8%A9%E5%BA%A6%E4%BC%A0%E6%84%9F%E5%99%A8%20%20%E5%8D%95%E6%80%BB%E7%BA%BF%E9%80%9A%E4%BF%A1.assets/image-20200215162942636.png)

*12位工作模式下将温度寄存器的值乘0.0625即为温度*

## 通过单总线端口访问DS18B20的协议如下

1. 初始化
2. ROM操作指令
3. DS18B20功能指令
   温度转换命令
   读取暂存器命令

###部分ROM指令

#### 忽略ROM指令（CCh）

总线上只有一个从机时因为不需要取元件的序列码所以传入该命令

>这条指令允许总线控制器不用提供64 位ROM 编码就使用功能指令。例如，总线控制器可以先发出一条忽略ROM 指令，然后发出温度转换指令[44h]，从而完成温度转换操作。在单点总线情况下使用该命令，器件无需发回64 位ROM 编码，从而节省了时间。如果总线上有不止一只从机，若发出忽略ROM指令，由于多只从机同时传送信号，总线上就会发生数据冲突。

#### 温度转换指令(44h)

>这条命令用以启动一次温度转换。温度转换指令被执行，产生的温度转换结果数据以2个字节的形式被存储在高速暂存器中，而后DS18B20保持等待状态

#### 读暂存器指令(BEh)

>这条命令读取暂存器的内容。读取将从字节0 开始，一直进行下去，直到读完暂存器所有字节，如果不想读完所有字节，控制器可以在任何时间发出复位命令来中止读取。

#### 写暂存器指令(4Eh)

>这条命令向DS18B20 的暂存器写入数据，开始位置在TH 寄存器（暂存器的第2个字节），接下来写入TL 寄存器（暂存器的第3 个字节），最后写入配置寄存器（暂存器的第4 个字节）

#### 拷贝暂存器指令(48h)

可以实现掉电配置不丢失

>这条命令把TH,TL 和配置寄存器（第2、3、4 字节）的内容拷贝到EEPROM 中。

![image-20200215192310520](DS18B20%E6%B8%A9%E5%BA%A6%E4%BC%A0%E6%84%9F%E5%99%A8%20%20%E5%8D%95%E6%80%BB%E7%BA%BF%E9%80%9A%E4%BF%A1.assets/image-20200215192310520.png)

## 单总线时序

>DS18B20采用1-wire Bus所有数据都在一条线上传输，因此单总线协议对时序要求非常严格以确保数据的完整性。

单总线信号类型:**复位脉冲、存在脉冲、写0、写1、读0、读1**  所有这些信号除存在脉冲由DS18B20发出的以外其他信号都由总线控制器发出。

**数据传输总是从最低有效位开始**

### 初始化时序

初始化时序里面包含了复位DS18B20和接收DS18B20返回的存在信号。
**主机和DS18B20做任何通讯前都需要对其初始化。**初始化期间，总线控制器拉低总线并保持480us以上挂在总线上的器件将被复位，然后释放总线，等到15-60us，此时18B20将返回一个60-240us之间的低电平存在信号。

### 写时序

总线控制器通过控制单总线高低电平持续时间从而把逻辑1或0写DS18B20中。
总线控制器要产生一个写时序，必须将总线拉低最少1us，产生写0时序时总线必须保持低电平60~120us之间，然后释放总线，产生写1时序时在总线产生写时序后的15us内允许把总线拉高。注意：2次写周期之间至少间隔1us

### 读时序

   总线控制器通过读取由DS18B20控制的总线高低电平接收DS18B20数据。
总线控制器要产生一个读时序，必须将总线拉低至少1us，然后释放总线，在读信号开始后15us内总线控制器采样总线数据，读一位数据至少保持在60us以上。注意：2次读周期之间至少间隔1us